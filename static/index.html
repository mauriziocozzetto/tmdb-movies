<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <title>MovieDB - Home</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #0d253f;
            color: white;
            font-family: sans-serif;
        }

        .movie-card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .img-box {
            background-color: #032541;
            aspect-ratio: 2/3;
            overflow: hidden;
            position: relative;
        }

        img {
            opacity: 0;
            transition: opacity 0.3s;
        }

        img.loaded {
            opacity: 1;
        }
    </style>
</head>

<body>
    <header class="bg-[#032541] p-4 border-b border-white/5">
        <h1 class="max-w-7xl mx-auto text-[#01b4e4] font-black text-2xl uppercase cursor-pointer"
            onclick="location.href='/'">MovieDB</h1>
    </header>

    <main>
        <section class="bg-[#032541] px-10 py-20 text-white">
            <div class="max-w-7xl mx-auto">
                <h2 class="text-6xl font-extrabold mb-4">Benvenuto.</h2>
                <p class="text-2xl font-bold opacity-80 mb-10">Esplora milioni di film e persone. Cerca ora.</p>
                <div class="flex bg-white rounded-full overflow-hidden max-w-4xl shadow-2xl">
                    <input id="searchInput" type="text" placeholder="Cerca un film..."
                        class="flex-1 px-8 py-4 text-gray-800 outline-none text-lg font-normal">
                    <button id="searchBtn"
                        class="bg-gradient-to-r from-[#1ed5a9] to-[#01b4e4] px-10 py-4 font-bold text-white uppercase tracking-wider hover:opacity-90 transition">
                        Cerca
                    </button>
                </div>
            </div>
        </section>

        <section class="max-w-7xl mx-auto p-10">
            <h3 id="sectionTitle"
                class="text-2xl font-bold mb-8 border-l-4 border-[#01b4e4] pl-4 uppercase tracking-widest text-white">
                Tendenze della settimana</h3>

            <div id="movieGrid" class="grid grid-cols-2 md:grid-cols-5 gap-8">
            </div>

            <div id="noResults" class="hidden py-20 text-center">
                <p class="text-xl font-bold text-gray-400 uppercase tracking-widest">Nessun film trovato per questa
                    ricerca.</p>
            </div>
        </section>
    </main>

    <script>
        const grid = document.getElementById('movieGrid');
        const noResults = document.getElementById('noResults');
        const sectionTitle = document.getElementById('sectionTitle');

        // Funzione universale per disegnare le card
        const renderMovies = (list) => {
            grid.innerHTML = '';
            if (!list || list.length === 0) {
                grid.classList.add('hidden');
                noResults.classList.remove('hidden');
                return;
            }
            grid.classList.remove('hidden');
            noResults.classList.add('hidden');

            list.forEach(m => {
                const card = document.createElement('div');
                card.className = 'movie-card cursor-pointer hover:scale-105 transition duration-300';
                card.onclick = () => window.location.href = `/movie.html?id=${m.id}`;

                // Utilizzo dei nomi dei campi validati dal backend (Pydantic)
                card.innerHTML = `
                    <div class="img-box">
                        <img src="${m.poster_path}" onload="this.classList.add('loaded')" 
                             onerror="this.classList.add('loaded');" class="w-full h-full object-cover">
                    </div>
                    <div class="p-4 text-gray-900">
                        <p class="font-bold truncate text-base">${m.title}</p>
                        <p class="text-gray-500 text-sm font-normal">${m.release_date}</p>
                    </div>`;
                grid.appendChild(card);
            });
        };

        // Caricamento Iniziale (Trending)
        const loadTrending = () => {
            fetch('/api/films/trendings')
                .then(r => r.json())
                .then(renderMovies)
                .catch(err => console.error("Errore caricamento trend:", err));
        };

        // Funzione di Ricerca
        const executeSearch = () => {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) {
                sectionTitle.textContent = "Tendenze della settimana";
                loadTrending();
                return;
            }

            fetch(`/api/films/search?title=${encodeURIComponent(query)}`)
                .then(r => r.json())
                .then(list => {
                    sectionTitle.textContent = `Risultati per: ${query}`;
                    renderMovies(list);
                });
        };

        // Event Listeners
        document.getElementById('searchBtn').onclick = executeSearch;
        document.getElementById('searchInput').onkeypress = (e) => {
            if (e.key === 'Enter') executeSearch();
        };

        // Avvio
        loadTrending();
    </script>
</body>

</html>
