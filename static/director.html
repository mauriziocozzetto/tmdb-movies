<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <title>MovieDB - Regista</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #f8fafc;
            font-family: sans-serif;
        }

        .img-box {
            background-color: #032541;
            aspect-ratio: 2/3;
            overflow: hidden;
        }

        img {
            opacity: 0;
            transition: opacity 0.3s;
        }

        img.loaded {
            opacity: 1;
        }
    </style>
</head>

<body>
    <header class="bg-[#032541] p-4 text-white font-bold">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <h1 class="text-[#01b4e4] font-black text-2xl uppercase cursor-pointer" onclick="location.href='/'">MovieDB
            </h1>
            <a href="/" class="uppercase tracking-widest text-sm hover:text-[#01b4e4]">‚Üê Home</a>
        </div>
    </header>

    <main class="max-w-7xl mx-auto p-10">
        <div id="bio-section" class="grid md:grid-cols-[300px_1fr] gap-12 mb-16">
        </div>

        <h3 class="text-2xl font-bold mb-8 border-l-4 border-[#01b4e4] pl-4 uppercase tracking-widest">Filmografia
            (Regia)</h3>
        <div id="movie-grid" class="grid grid-cols-2 md:grid-cols-5 gap-8">
        </div>
    </main>

    <script>
        const did = new URLSearchParams(window.location.search).get('id');
        if (!did) window.location.href = '/';

        // 1. Dati Regista
        fetch(`/api/directors/${did}`).then(r => r.json()).then(a => {
            document.getElementById('bio-section').innerHTML = `
                <div class="img-box rounded-lg shadow-xl"><img src="${a.profile_path}" onload="this.classList.add('loaded')" class="w-full h-full object-cover"></div>
                <div>
                    <h1 class="text-5xl font-extrabold mb-2 text-[#032541]">${a.name}</h1>
                    <p class="text-[#01b4e4] font-bold uppercase tracking-widest mb-6">Regista</p>
                    <div class="flex gap-8 mb-6 text-sm font-bold uppercase tracking-widest">
                        <div><p class="text-gray-400">Nascita</p><p class="text-gray-800">${a.birthday}</p></div>
                        <div><p class="text-gray-400">Luogo</p><p class="text-gray-800">${a.place_of_birth}</p></div>
                    </div>
                    <p class="text-gray-400 uppercase text-xs font-bold tracking-widest mb-2">Biografia</p>
                    <p class="text-lg leading-relaxed text-gray-700">${a.biography}</p>
                </div>`;
        });

        // 2. Filmografia (Nota: qui usiamo l'endpoint specifico per la regia)
        // Se non hai creato /api/directors/{id}/films nel backend, puoi usare 
        // l'endpoint del cast filtrando nel frontend o crearne uno nuovo.
        // In questo esempio usiamo la rotta speculare immaginaria per coerenza:
        fetch(`/api/actors/${did}/films`).then(r => r.json()).then(list => {
            const g = document.getElementById('movie-grid');
            if (list.length === 0) {
                g.innerHTML = `<p class="col-span-full text-center py-10 text-gray-400 font-bold uppercase tracking-widest">Nessun film diretto trovato</p>`;
                return;
            }
            list.forEach(m => {
                const d = document.createElement('div');
                d.className = 'bg-white rounded-lg shadow-md overflow-hidden cursor-pointer hover:scale-105 transition';
                d.onclick = () => window.location.href = `/movie.html?id=${m.id}`;
                d.innerHTML = `
                    <div class="img-box"><img src="${m.poster_path}" onload="this.classList.add('loaded')" class="w-full h-full object-cover"></div>
                    <div class="p-4"><p class="font-bold text-gray-900 truncate">${m.title}</p><p class="text-gray-400 text-sm">${m.release_date}</p></div>`;
                g.appendChild(d);
            });
        });
    </script>
</body>

</html>
