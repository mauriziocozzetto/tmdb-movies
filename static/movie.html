<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <title>MovieDB - Dettaglio Film</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #f8fafc;
            font-family: sans-serif;
        }

        .hero-bg {
            background-color: #032541;
            color: white;
        }

        .img-box {
            background-color: #0d253f;
            aspect-ratio: 2/3;
            overflow: hidden;
        }

        img {
            opacity: 0;
            transition: opacity 0.3s;
        }

        img.loaded {
            opacity: 1;
        }
    </style>
</head>

<body>
    <header class="bg-[#032541] p-4 text-white border-b border-white/10">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <h1 class="text-[#01b4e4] font-black text-2xl uppercase cursor-pointer" onclick="location.href='/'">MovieDB
            </h1>
            <a href="/" class="text-sm font-bold uppercase tracking-widest hover:text-[#01b4e4]">‚Üê Home</a>
        </div>
    </header>

    <main>
        <section class="hero-bg py-12">
            <div id="hero" class="max-w-7xl mx-auto px-6 grid md:grid-cols-[300px_1fr] gap-12">
            </div>
        </section>

        <section class="max-w-7xl mx-auto p-10">
            <h3 class="text-2xl font-bold mb-8 border-l-4 border-[#01b4e4] pl-4 uppercase tracking-widest">Cast
                Principale</h3>
            <div id="cast" class="grid grid-cols-2 md:grid-cols-6 gap-6">
            </div>
        </section>
    </main>

    <script>
        const fid = new URLSearchParams(window.location.search).get('id');
        if (!fid) window.location.href = '/';

        // 1. Dettagli Film e Registi
        Promise.all([
            fetch(`/api/films/${fid}`).then(r => r.json()),
            fetch(`/api/films/${fid}/directors`).then(r => r.json())
        ]).then(([m, directors]) => {
            const dirLinks = directors.map(d =>
                `<a href="/director.html?id=${d.id}" class="text-[#01b4e4] hover:underline font-bold">${d.name}</a>`
            ).join(', ');

            document.getElementById('hero').innerHTML = `
                <div class="img-box rounded-lg shadow-2xl">
                    <img src="${m.poster_path}" onload="this.classList.add('loaded')" class="w-full h-full object-cover">
                </div>
                <div>
                    <h1 class="text-5xl font-extrabold mb-4">${m.title} <span class="opacity-50 font-normal">(${m.release_date})</span></h1>
                    <div class="bg-slate-900 border-2 border-[#1ed5a9] w-14 h-14 rounded-full flex items-center justify-center font-bold text-lg mb-8">${Math.round(m.vote_average * 10)}%</div>
                    <div class="mb-8">
                        <p class="text-gray-400 uppercase text-xs font-bold tracking-widest mb-1">Regia</p>
                        <p class="text-xl">${dirLinks || 'Informazione non disponibile'}</p>
                    </div>
                    <p class="text-gray-400 uppercase text-xs font-bold tracking-widest mb-1">Sinossi</p>
                    <p class="text-lg leading-relaxed text-gray-200">${m.overview}</p>
                </div>`;
        });

        // 2. Cast
        fetch(`/api/films/${fid}/actors`).then(r => r.json()).then(list => {
            const container = document.getElementById('cast');
            if (list.length === 0) {
                container.innerHTML = `<p class="col-span-full text-center py-10 text-gray-400 uppercase font-bold tracking-widest">Nessun attore trovato</p>`;
                return;
            }
            list.forEach(a => {
                const d = document.createElement('div');
                d.className = 'bg-white rounded-lg shadow-md overflow-hidden cursor-pointer hover:scale-105 transition';
                d.onclick = () => window.location.href = `/actor.html?id=${a.id}`;
                d.innerHTML = `
                    <div class="img-box"><img src="${a.profile_path}" onload="this.classList.add('loaded')" class="w-full h-full object-cover"></div>
                    <div class="p-3"><p class="font-bold text-gray-900 leading-tight">${a.name}</p><p class="text-gray-500 text-xs mt-1">${a.character}</p></div>`;
                container.appendChild(d);
            });
        });
    </script>
</body>

</html>
